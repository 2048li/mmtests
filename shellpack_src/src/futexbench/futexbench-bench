#!/bin/bash
# Run perf-bench futex benchmark

###SHELLPACK preamble futexbench 3.16.3
TESTTIME=15
ITERATIONS=12
TESTLIST=

###SHELLPACK parseargBegin
###SHELLPACK parseargInstall
###SHELLPACK parseargEnd

###SHELLPACK check_install_required futexbench-${VERSION}

PERF_DIR=tools/perf/
PERF_CMD=${PERF_DIR}/perf
NR_THREADS=`grep -c ^processor /proc/cpuinfo`

# Plain and simple, run all futex tests. Note that
# each one (ie: wake, requeue, hash) include their
# own default number of runs.
monitor_pre_hook $LOGDIR_RESULTS $NR_THREADS
$PERF_CMD bench futex all 2>&1 | tee $LOGDIR_RESULTS/futexbench-$NR_THREADS.log \
    || die Failed ro run perf-bench futex
monitor_post_hook $LOGDIR_RESULTS $NR_THREADS

exit $SHELLPACK_SUCCESS
